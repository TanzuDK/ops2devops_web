[{"uri":"/","title":"","tags":[],"description":"","content":"Ops 2 DevOps Welcome Welcome to Ops2Devops training. The purpose of this training, is to introduce you, to tools and technologies, that serve as the foundation, for Devops.\nAfter this training, you will not be an expert, but you should be able to understand different Path2Production flows, and be able to focus on how to advance further, in your path to learning more.\n"},{"uri":"/5.cicd/1/","title":"01 Actions file","tags":[],"description":"","content":"We will now setup automatic building of docker images, and pushing it to your private repo, using GitHub Actions.\n Open docker-publish.yml Talk about the the file in class.  On Env Variables Jobs Packages    "},{"uri":"/2.git/1/","title":"01 Configure Git","tags":[],"description":"","content":"To use git, you must first setup the username and email, og the person making the changes.\n  To configure git with your user, type the following commands with your own name and email.\ngit config --global user.name \u0026quot;John Doe\u0026quot;\ngit config --global user.email johndoe@example.com\n  "},{"uri":"/3.docker/1/","title":"01 Docker Hub","tags":[],"description":"","content":" Open https://hub.docker.com Search for Nginx Click on the Official Image (should be the one on top)  Go thru the documentation in class :  Official Image Reference Tags Image variants OS/Arch Use of the image (Examples)    "},{"uri":"/1.connect/1/","title":"01 Ipadresses","tags":[],"description":"","content":" All Student ipadresses are shared from a Notion page, found here. Dont copy them, until the teacher has updated with the ipadessed, relevant for the current class.  You will be given a student number. Each student has a public ipadress. Write it down, since you will you it many times today.\nAlso write down the public ipadress of the Kubernetes Cluster (Also found on the page)\n"},{"uri":"/4.k8s/1/","title":"01 Setup Kubeconfig","tags":[],"description":"","content":"To access a kubernetes cluster, you first need to have a kubeconfig file. This files is located in your home directory, in the .kube directory.\nOn your current machine, there is no kubeconfig file, so in the next few steps, we will copy it, using SCP, from the kubernetes host.\n Run scp ubuntu@10.0.1.9:/home/ubuntu/.kube/config /home/ubuntu/.kube/config Type yes to Accept certificate Type password VMware1! Look at the config file by running cat /home/ubuntu/.kube/config and talk about it\u0026rsquo;s content in class.  Certificate server context users    "},{"uri":"/5.cicd/2/","title":"02 Copy actions file","tags":[],"description":"","content":"To activate a actions file, you need to place it in the .github/workflows and push it to github. We will do this now.\n Copy the file, to the root of your github repo, under .github/workflows by running this cp docker-publish.yml ../../.github/workflows and commit and push your repo after.  "},{"uri":"/2.git/2/","title":"02 Create first Git Repository","tags":[],"description":"","content":"Using the terminal run the following commands, to create and initialize your first git repository\n  Create Folder\nmkdir myfirstrepo\n  Open folder\ncd myfirstrepo\n  Initialize git\ngit init\n  Check a new .git folder has been created with content\nls .git\n  You should see a lot of files and folders. These are the files used by Git, to track all changes you make in you new Git repository.\n"},{"uri":"/3.docker/2/","title":"02 Dockerfile","tags":[],"description":"","content":" Open the Dockerfile in VSCode Go thru the different options  FROM WORKDIR RUN COPY EXPOSE CMD    "},{"uri":"/4.k8s/2/","title":"02 Kubectl","tags":[],"description":"","content":" Talk in class about Kubectl:  CLI/API Yaml files vs commands    "},{"uri":"/3.docker/3/","title":"03 Build Container","tags":[],"description":"","content":" If you don\u0026rsquo;t already have a terminal, in the 3.Docker/1.Task directory, then right click the directory on the left, and select Open in integrated terminal This opens a terminal, in the correct directory. Change directory, for each task, either by command, or by doing the above step, each time you progress. Run docker build -t web:v1 . (Note the . in the end) Watch the build finish When it\u0026rsquo;s done, you should read Successfully tagged web:v1 This means you build a local container, named web:1 Run docker image ls to see the images local on the machine Note you will see both the Web container, and the nginx container, that the web container was build on. As part of this workshop, where will also be a couple of other images, that all start with registry.tanzu.dk, but that is for a later step.  "},{"uri":"/2.git/3/","title":"03 Create first Git Changes (CLI)","tags":[],"description":"","content":"Using the terminal, we will now create the first changes to the Git repository.\n  Create a file with text\necho \u0026quot;initial content\u0026quot; \u0026gt; file1.txt\n  Stage changes\ngit add .\n  commit changes\ngit commit -m \u0026quot;My first change\u0026quot;\n  make a new change to the file\necho \u0026quot;new content\u0026quot; \u0026gt; file1.txt\n  Stage the new changes\ngit add .\n  commit new changes\ngit commit -m \u0026quot;My second change\u0026quot;\n  See the changes you have done\ngit log --graph\n  You should now see a log of all the changes you have made.\n"},{"uri":"/5.cicd/3/","title":"03 See running action","tags":[],"description":"","content":" Open github.com and find your repository, and select Actions Under Workflows your should now see 2 workflows. 4-k8s-1 and 5-k8s-1. The naming represents module and task, of this class. We will only focus on 5-k8s-1 from now on. Click on the top Workflow Run. The name is the same as your last commit message. You should now see your stages. You only have one called Build so click on that. You can now see all the stages, that we setup in the file. Click on the Code tab, and then on Packages in the right side. Here you can see the 2 container images, you have in your repository. They are now build automaticly, on every push you do. !!! If any of your container images has a private label next to it, then follow the steps from 4.Kubernetes/1.Taskto make it public.  "},{"uri":"/4.k8s/3/","title":"03 Test connection","tags":[],"description":"","content":" Run kubectl get nodes to see you can connect and that the Kubernetes nodes are active The result should be something like this :  NAME STATUS ROLES AGE VERSION k8s Ready \u0026lt;none\u0026gt; 6d1h v1.23.4-2+98fc2022f3ad3e  This shows the different nodes of the Kubernetes Cluster, State, Role, Age and version. In this workshop, we are working with a single node Kubernetes cluster, but in the real world, there would probably be 3 masters, and a large number of workers. The commands we are using, are the same. We just don\u0026rsquo;t have the same failover capabilities and scale.  "},{"uri":"/2.git/4/","title":"04 Create first Git Changes (GUI)","tags":[],"description":"","content":"Usiong the GUI (VScode) we will now do the same as before.\n  Open the folder in vscode.\n  If presented witha security warning, then click yes, to trusting the folder.\n  Open file1.txt and add or change the content\n  Save the file\n  See the number on the icon to the left.\n  Select the Soruce control icon\n  Select the file\n  See the changes you made to the file, compared with the current version\n  Type commit message in the \u0026ldquo;Message\u0026rdquo; box in the top and apply it, bly clicking Command + Enter\n  To prepare for the next step, select Close Folder from the Top menubar File menu.\n  "},{"uri":"/4.k8s/4/","title":"04 Create Namespace","tags":[],"description":"","content":" Run kubectl create ns studentx where x is replaced with your student number (See cli if in doubt) Run kubectl get ns and see that your namespace has been created Talk in class, about the concept of a Kubernetes namespace  "},{"uri":"/5.cicd/4/","title":"04 Discuss Action concepts","tags":[],"description":"","content":" Talk in class about :  Versions Triggers Build phases Variables Secrets Artifacts Types of jobs Hosted runners    "},{"uri":"/3.docker/4/","title":"04 Run Container","tags":[],"description":"","content":" Run docker run -p 80:80 web:v1 open a browser to the public ip of your student VM, from your local machine http://studentip:80 See the website that is running :-) Note that when you connect to the website, the logs from the container, is updated in the console. Stop the container pressing ctrl + c  "},{"uri":"/4.k8s/5/","title":"05 Deployment.yml","tags":[],"description":"","content":" Open deployment.yml file Go thru the file and talk in class about :  apiVersion Kind Containers Limits    "},{"uri":"/3.docker/5/","title":"05 Make Changes","tags":[],"description":"","content":" Edit html/index.html by replacing the Student xxx with your name. Build a new version of the container, by running docker build -t web:v2 . Run the new version docker run -p 80:80 web:v2 open a browser to http://studentip:80 and see that the content has changed. Stop the container again by pressing ctrl + c  "},{"uri":"/5.cicd/5/","title":"05 Trigger build","tags":[],"description":"","content":" Change the index.html file under html with new content. And commit and push changes to GitHub. Watch the action trigger again, and see a new build being created.  "},{"uri":"/4.k8s/6/","title":"06 Github Packages","tags":[],"description":"","content":" We are using Github\u0026rsquo;s version of docker Hub. To make sure, we don\u0026rsquo;t have to struggle with autentification in this lab, open your forked repository on github.com. Click Packages If the package has a private label next to it, follo the following steps. If not, you can skip ahead.  Click on the package name 4-k8s-1 Select Package settings on the right Click Change visibility in the Danger Zone area in the bottom. Change to public and type in the text that you prompted for.    "},{"uri":"/5.cicd/6/","title":"06 Prepare Kubeconfig file for CI/CD","tags":[],"description":"","content":"Since the certificate, don\u0026rsquo;t match the external ip of your Kubernetes cluster, it wont work. To fix this, we will remove the certificate section, and add a Insecure tag into it.\n Run sed \u0026quot;s/certificate-authority-data:.*/insecure-skip-tls-verify: true/g\u0026quot; /home/ubuntu/.kube/config \u0026gt; kubeconfig.yml to allow connectivity external, without verifying the certificate. Open kubeconfig.yml and change the local ip under server to the public ip of the K8S server (Same port and protocol)  "},{"uri":"/3.docker/6/","title":"06 See different images","tags":[],"description":"","content":" run docker ps -a and see that you have 2 versions of the web container. Note the names is auto generated, to make sure there is no conflick between them. Also note, that this is the actual containers, that are build on the images. You can have multiple containers, build on the same image.  "},{"uri":"/4.k8s/7/","title":"07 Deploy first K8S app","tags":[],"description":"","content":" Change all places in deployment.yml from studentx to your student number. Open your repository in github.com and click on ops2devops/4-k8s-1 under Packagesin the bottom right. !!! If you can\u0026rsquo;t see any packages, then it\u0026rsquo;s probably because you forgot to commit and push your git changes, after each task. Get help from the teacher, or use this url for now ghcr.io/tanzudk/ops2devops/4-k8s-1:master copy the entire url after docker pull Replace the url after image, with your own in the deployment.ymlfile This is the url for your package in your Github registry. Save the file Run kubectl apply -f deployment.yml -n studentx This deploys the application in your own namespace Verify the application is deployed by running kubectl get all -n studentx Note we did not expose the app, to the outside work. That is for next Task. Delete the application by running kubectl delete -f deployment.yml -n studentx  "},{"uri":"/3.docker/7/","title":"07 Docker-Compose","tags":[],"description":"","content":"Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.\n  Open docker-compose.yml and examine the content of the file.\n  Note :\n Internal name Container name Build Ports Volumes (data is external from the container)    run docker-compose up to build and run the container.\n  Note we build the container in this example, but we could just as well, pull one from a registry.\n  open a browser to http://studentip:80 and see the website, is updated with a image, and text more fitting for this task.\n  Press ctrl+cto cancel the running container.\n  "},{"uri":"/5.cicd/7/","title":"07 Github Secrets","tags":[],"description":"","content":" Open github.com -\u0026gt; your repository -\u0026gt; Settings -\u0026gt; Secrets -\u0026gt; Actions Add new Repository secret with the name KUBE_CONFIG and paste the content from the kubeconfig.yml in the value field. The Variable KUBE_CONFIG can now be used, when your action run, in a more secure way.  "},{"uri":"/5.cicd/8/","title":"08 Change deployment.yml","tags":[],"description":"","content":" Open deployment.yml in VScode and change all variables to your student number. Remember to also change the port. Also change the iamge, to your new package you created in the last Task.  "},{"uri":"/4.k8s/8/","title":"08 Enhance deployment.yaml","tags":[],"description":"","content":" Add a line to deployment.yml under metadata(remember indentation) with namespace: studentx Run `kubectl apply -f deployment.yml`` See the deployment now happens in the namespace you just specified, by running kubectl get all -n studentx, without you typing it in each command. Delete the deployment again by running kubectl delete -f deployment.yml  "},{"uri":"/3.docker/8/","title":"08 Run as deamon","tags":[],"description":"","content":" run docker-compose up -d to run the container as a service run docker ps and see the container running. Note the name if the container, is nginx, and not reandom generated. open a browser to http://studentip:80 and see it\u0026rsquo;s still runnning as before. Open index.html and change Student xxx to your student number. Save the file and refresh the website, and see your changes. Note the changes is not build into the container, but instead directly presented from the html directory.  "},{"uri":"/5.cicd/9/","title":"09 K8S Deployment Action","tags":[],"description":"","content":" Open k8s-deploy.yml Talk in class about :  Action modules Secrets / Variables Run    "},{"uri":"/3.docker/9/","title":"09 Trubleshoot running container","tags":[],"description":"","content":"Trubleshoot running container  Run docker exec -it nginx /bin/bash to get a terminal into the running container See the promt changes to root@id Run /usr/share/nginx/html to list the html directory, from inside the container. Run exit to exit out of the container. Run docker ps to see the conainer is still running.  "},{"uri":"/4.k8s/9/","title":"09 Verify deployments / Pods","tags":[],"description":"","content":" If you want to see all deployments across namespaces, then run kubectl get deployments -A You can do the same with pods kubectl get pods -A Or just type kubectl get all -A if you want to see (almost) all types of things running.  "},{"uri":"/1.connect/","title":"1. Connect","tags":[],"description":"","content":"The purpose of this task, is to setup a working conection, to the demo enviroment. The enviroment consist of multiple ec2 instances, deployed in AWS. We connect and use the enviorement, using a versions of Visual Studio Code(vscode) called Code-Server, which enables us to use vscode, thru a webbrowser.\nThis setup gives us an easy way to see and edit files, while also getting a terminal connection.\nAll steps for this workshop, is described on this page, so it\u0026rsquo;s recommended to use 2 webbrowsers.\n for this website for vscode (Firefox or Chrome)  "},{"uri":"/5.cicd/10/","title":"10 Activate Deployment Action","tags":[],"description":"","content":" Copy k8s-deploy.yml to then workflows folder by running cp k8s-deploy.yml ../../.github/workflows and commit and push your repo after. Open github.com -\u0026gt; Actions and see your action run successfull. Run kubectl get all -n studentx to see your deployment and service beging deployed. Note the age of the deployments.  NAME READY STATUS RESTARTS AGE pod/studentx-deployment-648bffc4c7-lf4dg 1/1 Running 0 24s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/nginx-service NodePort 10.152.183.128 \u0026lt;none\u0026gt; 80:30010/TCP 23s NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/studentx-deployment 1/1 1 1 24s NAME DESIRED CURRENT READY AGE replicaset.apps/studentx-deployment-648bffc4c7 1 1 1 24s "},{"uri":"/4.k8s/10/","title":"10 Add service","tags":[],"description":"","content":"  Copy the deployment.yml file you created in last task by running cp ../1.Task/deployment.yml deployment.yml from the 2.Task directory\n  Edit the service.yml file, so the Selector: app namematches the name in the deployment.\n  Correct studentx to the correct student number.\n  Change the nodeport, to match your student number, in the last 2 digits.\n student0 = 30010 student1 = 30011 student2 = 30012 student3 = 30013 student4 = 30014 student5 = 30015 student6 = 30016 student7 = 30017 student8 = 30018 student9 = 30019 student10 = 30020 etc    In this demo enviroment, we are using Nodeport, to expose the deployments. Talk about the different ways you can expose a service :\n NodePort LoadBalancer Ingress    "},{"uri":"/3.docker/10/","title":"10 Cleanup","tags":[],"description":"","content":"To Cleanup the running container etc.\n run docker-compose down to stop the container.  "},{"uri":"/3.docker/11/","title":"11 Advanced Docker-Compose","tags":[],"description":"","content":"In this task, we are going to look at a more advanced Multi container Wordpress app.\n  Open docker-compose.yml\n  Run thru the file, and talk about the following :\n Multiple containers Env variables Links between containers Volumes Depends on restart policy    Run docker-compose up\n  Look at the images get pulled, and the install process runs.\n  Open http://studentip:80 and run thru the setup guide.\n  See you new have a full Wordpress site, with seperate Web and DB instances.\n  Press ctrl + c to stop the container.\n  "},{"uri":"/4.k8s/11/","title":"11 Deploy with Service","tags":[],"description":"","content":" Run kubectl apply -f . to deploy all .yml files in the directory You should see each file being created  deployment.apps/student1-deployment created service/nginx-service created  Run kubectl get all -n studentx to see your deployment and services has been deployed.  NAME READY STATUS RESTARTS AGE pod/student1-deployment-9888cf49d-w855n 1/1 Running 0 77s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/nginx-service NodePort 10.152.183.251 \u0026lt;none\u0026gt; 80:30010/TCP 77s NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/student1-deployment 1/1 1 1 77s NAME DESIRED CURRENT READY AGE replicaset.apps/student1-deployment-9888cf49d 1 1 1 77s  Open a browser to the public ip of the K8S server, with the port number you specified earlier http://K8SPublicIp:30010 and see your deployment is working, and is exposed to the outside world.  "},{"uri":"/4.k8s/12/","title":"12 Cleanup","tags":[],"description":"","content":" Cleanup by running kubectl delete -f .  "},{"uri":"/3.docker/12/","title":"12 Data / Volumes","tags":[],"description":"","content":" Run docker volume ls and see you now have 2 volumes.  DRIVER VOLUME NAME local 3task_db_data local 3task_wordpress_data  Talk in class about :  Volumes Driver / Location Sharing data between containers    "},{"uri":"/3.docker/13/","title":"13 Examine content of a volume","tags":[],"description":"","content":"To examine the content of a volume.\n Run docker volume ls to see the volumes Run docker volume inspect VolumeName on the volume you want to see details on. Copy the path under Mountpoint Run sudo ls MountPointPath to see the files in the volume. Note it\u0026rsquo;s only possible to see the files, using sudo, due to permissions.  "},{"uri":"/2.git/","title":"2. Git","tags":[],"description":"","content":"The purpose of this section, is to introduce the student to Git. "},{"uri":"/3.docker/","title":"3. Docker","tags":[],"description":"","content":"In this modulke, you will learn how to create a simple Docker container, Run it, and also how you can define a more complex container enviorement, using Docker-Compose. "},{"uri":"/4.k8s/","title":"4. Kubernetes","tags":[],"description":"","content":"The purpose of this task, is to learn how to deploy a simple application on kubernetes, and expose it to the network. "},{"uri":"/5.cicd/","title":"5. CI/CD","tags":[],"description":"","content":"The purpose of this task, is to create a CI/CD pipeline, using GitHub actions. "},{"uri":"/6.misc/","title":"6. MISC","tags":[],"description":"","content":"Usefull links CI/CD  Gitlab Github Tekton Jenkins ArgoCD Concourse Azure Devops  Kubernetes  VMware Tanzu TKG Amazon EKS Azure AKS Google GKE MicroK8S K3S  PAAS  Tanzu Application Platform Cloudfoundry  Containers  BuildPacks  Registrys  Harbor Docker Hub Artifactory  "},{"uri":"/_footer/","title":"","tags":[],"description":"","content":"For info see tanzu.vmware.com\n"},{"uri":"/_header/","title":"","tags":[],"description":"","content":"Tanzu.dk Ops2DevOps Workshop\n"},{"uri":"/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"/tags/","title":"Tags","tags":[],"description":"","content":""}]